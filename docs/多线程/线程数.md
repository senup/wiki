---
title: 线程数
date: 2024-01-07 12:14:40
Tags:
  - tech
Draft: true
HideInList: false
Feature: 
IsTop: false
---

当你的任务是 CPU 密集型的，也就是需要大量的计算，没有 IO，那么线程数应该设置为 CPU 的核心数。因为多出的线程并不能得到 CPU 的计算资源，反而会因为线程上下文切换带来额外的开销。就好比一台独轮车，你只有一个马在拉，再多的马也没用，甚至可能扰乱原本的马。

如果你的任务是 IO 密集型的，也就是有很多的 IO，比如文件操作、数据库操作、网络操作，那么线程数可以设置为核心数的两倍。因为 IO 操作不占用 CPU，所以当一个线程等待 IO 时，CPU 可以把计算资源分配给其他线程使用。这就像你在接电话，只要你的电话线路够多，你就可以同时和很多人通话，虽然你在喋喋不休，但人家可能还在找话题呢，这样你的时间就没浪费。

对于混合型的任务，既有计算也有 IO，那么就需要根据实际情况来判断应该创建多少线程。一种常见的方法是，先设置线程数为 CPU 核心数，然后观察 CPU 的利用率，如果 CPU 的利用率低于 70%，那么就可以适当增加线程数，直到 CPU 的利用率达到 70%-80%。

这个问题可以类比为一个餐厅，假设你是老板，服务员（线程）的数量就决定了你餐厅最多能服务多少客人。如果大部分客人都是来吃饭（CPU 密集型任务），那么服务员太多只会反而造成混乱。如果大部分客人来的目的是喝茶聊天（IO 密集型任务），那么更多的服务员可以更好的提供服务。

总的来说，设定合适的线程数需要你对程序的负载、系统的能力和任务的性质有一个清晰的了解。多做调试和测试，找到最佳的平衡点才是关键。

<!--more-->
