---
title: codereview
date: 2023-12-27 10:18:49
Tags:
  - tech
Draft: true
HideInList: false
Feature: 
IsTop: false
---

## 代码审查
|项目类别|需要检查的内容|
|---|---|
|MQ消费者|幂等、并发、时序性、异常重试|
|MQ生产者|是否可以重推、推送报文大小|
|接口|非空校验、幂等、并发、调用外部接口是否有重试或者降级|
|**数据库操作** |是否全表查询、是否走索引、是否需要事务、是否正确使用事务、DDL脚本、新增字段是否合理|
|定时任务|是否可以多机调度(是否运行重复执行同一条数据、每次执行的最大数量，是否有分页）|
|初始化数据|是否分批处理、性能如何、代码逻辑、异常捕获|
|**缓存** |是否有[[Redis大key]]、是否设置过期时间，过期时间是否合理 |
|明显代码逻辑|if判断写反，BigDecimal比较，字段未赋值，使用错的变量，OOM风险（如一次性从数据中取出大量数据），空指针， 并行流访问数据库|
|代码规范|Ali提出的代码规约，代码是否写在适当的服务中（job、eas、user、dao层不允许有业务逻辑），命名可读性，是否打日志便于排查问题，关键步骤是否有日志|
|接口校验|需要返回复杂提示信息时，可以先写前置校验接口返回复杂信息，真正操作接口再次校验时，只返回一句提示原因|

## 实际经验
内部接口定义：注意 post 请求的注解有没有添加上、非空检验、校验注解正不正确@notNull 和@NotBlank
调用外部接口：是否需要重试或者降级，减少对系统的影响；
使用数据库的 Mapper 操作：是否全表查询、是否走索引、新增字段是不是合理、是否使用递归、是否使用事务
redis 缓存：[[Redis大key]]、是否设置过期时间、过期时间是否合理
定时任务：中断后会有什么问题、每次执行的数量、有无回滚措施、是否先查再做数据处理
MQ 消费者：是否幂等，比如数据先查询有无再做更新或者新增；并发会不会有问题，消息的顺序性，消费能力是否足够
MQ 生产者：有没有补推机制，每次推送多少

最多的是代码逻辑：内存操作大数据、if 判断写反、字段未赋值、空指针、并行流访问、阿里规范
日志：日志是否又臭又长，是否可以精简
初始化：分批处理、是否可以回滚、异常捕获、是否有开关控制
字段替换：上线前会不会有接口把流量打到老的请求体中


<!--more-->